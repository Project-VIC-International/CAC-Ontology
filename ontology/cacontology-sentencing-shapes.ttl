@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix uco-core: <https://ontology.unifiedcyberontology.org/core#> .
@prefix uco-identity: <https://ontology.unifiedcyberontology.org/identity#> .
@prefix uco-action: <https://ontology.unifiedcyberontology.org/action#> .
@prefix uco-role: <https://ontology.unifiedcyberontology.org/role#> .
@prefix case-investigation: <https://ontology.caseontology.org/case/investigation#> .
@prefix cacontology: <https://cacontology.projectvic.org#> .
@prefix cacontology-sentencing: <https://cacontology.projectvic.org/sentencing#> .

# =============================================================================
# SENTENCING OUTCOME SHAPES
# =============================================================================

icac-sentencing:SentencingOutcomeShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:SentencingOutcome ;
    rdfs:label "Sentencing Outcome Shape"@en ;
    rdfs:comment "Validation shape for sentencing outcome instances."@en ;
    sh:property [
        sh:path icac-sentencing:sentenceType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "imprisonment" "probation" "suspended_sentence" "community_service" "fine" "restitution" "treatment_order" "mixed_sentence" ) ;
        sh:message "Sentencing outcome must specify sentence type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:sentenceDuration ;
        sh:datatype xsd:decimal ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minInclusive 0.0 ;
        sh:maxInclusive 50.0 ;
        sh:message "Sentence duration must be between 0 and 50 years."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:sentenceDate ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Sentencing outcome must specify sentence date."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:jurisdiction ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "federal" "state" "local" "military" "tribal" "international" ) ;
        sh:message "Sentencing outcome must specify jurisdiction from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:appealStatus ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:in ( "no_appeal" "appeal_pending" "appeal_denied" "appeal_granted" "sentence_modified" "conviction_overturned" ) ;
        sh:message "Appeal status must be from the allowed list."@en
    ] .

icac-sentencing:ImprisonmentSentenceShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:ImprisonmentSentence ;
    rdfs:label "Imprisonment Sentence Shape"@en ;
    rdfs:comment "Validation shape for imprisonment sentence instances."@en ;
    sh:property [
        sh:path icac-sentencing:facilityType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "federal_prison" "state_prison" "county_jail" "minimum_security" "medium_security" "maximum_security" "supermax" ) ;
        sh:message "Imprisonment sentence must specify facility type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:paroleEligibility ;
        sh:datatype xsd:boolean ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Imprisonment sentence must specify parole eligibility."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:minimumServed ;
        sh:datatype xsd:decimal ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minInclusive 0.0 ;
        sh:maxInclusive 50.0 ;
        sh:message "Minimum time served must be between 0 and 50 years."@en
    ] .

icac-sentencing:ProbationSentenceShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:ProbationSentence ;
    rdfs:label "Probation Sentence Shape"@en ;
    rdfs:comment "Validation shape for probation sentence instances."@en ;
    sh:property [
        sh:path icac-sentencing:probationConditions ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1 ;
        sh:maxInclusive 50 ;
        sh:message "Probation sentence must have between 1 and 50 conditions."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:supervisionLevel ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "unsupervised" "administrative" "standard" "intensive" "electronic_monitoring" "residential" ) ;
        sh:message "Probation sentence must specify supervision level from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:reportingFrequency ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "monthly" "bi_weekly" "weekly" "daily" "as_directed" "none" ) ;
        sh:message "Probation sentence must specify reporting frequency from the allowed list."@en
    ] .

# =============================================================================
# LEGAL CHARGE SHAPES
# =============================================================================

icac-sentencing:LegalChargeShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:LegalCharge ;
    rdfs:label "Legal Charge Shape"@en ;
    rdfs:comment "Validation shape for legal charge instances."@en ;
    sh:property [
        sh:path icac-sentencing:chargeType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "felony" "misdemeanor" "infraction" "violation" "contempt" "federal_crime" ) ;
        sh:message "Legal charge must specify charge type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:chargeClass ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "class_a" "class_b" "class_c" "class_d" "class_e" "unclassified" "capital" ) ;
        sh:message "Legal charge must specify charge class from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:statuteReference ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minLength 5 ;
        sh:maxLength 100 ;
        sh:message "Legal charge must specify statute reference (5-100 characters)."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:maximumPenalty ;
        sh:datatype xsd:decimal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 0.0 ;
        sh:maxInclusive 99.0 ;
        sh:message "Maximum penalty must be between 0 and 99 years."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:pleaEntered ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:in ( "guilty" "not_guilty" "no_contest" "alford_plea" "not_entered" ) ;
        sh:message "Plea entered must be from the allowed list."@en
    ] .

icac-sentencing:FelonyChargeShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:FelonyCharge ;
    rdfs:label "Felony Charge Shape"@en ;
    rdfs:comment "Validation shape for felony charge instances."@en ;
    sh:property [
        sh:path icac-sentencing:felonyLevel ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "first_degree" "second_degree" "third_degree" "fourth_degree" "unclassified" "capital" ) ;
        sh:message "Felony charge must specify felony level from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:violentCrime ;
        sh:datatype xsd:boolean ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Felony charge must specify if it is a violent crime."@en
    ] .

# =============================================================================
# CONVICTION RECORD SHAPES
# =============================================================================

icac-sentencing:ConvictionRecordShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:ConvictionRecord ;
    rdfs:label "Conviction Record Shape"@en ;
    rdfs:comment "Validation shape for conviction record instances."@en ;
    sh:property [
        sh:path icac-sentencing:convictionDate ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Conviction record must specify conviction date."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:convictionType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "jury_verdict" "bench_trial" "plea_agreement" "default_judgment" "summary_conviction" ) ;
        sh:message "Conviction record must specify conviction type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:chargeCount ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1 ;
        sh:maxInclusive 100 ;
        sh:message "Conviction record must have between 1 and 100 charges."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:priorConvictions ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minInclusive 0 ;
        sh:maxInclusive 50 ;
        sh:message "Prior convictions must be between 0 and 50."@en
    ] .

# =============================================================================
# SENTENCING GUIDELINES SHAPES
# =============================================================================

icac-sentencing:SentencingGuidelinesShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:SentencingGuidelines ;
    rdfs:label "Sentencing Guidelines Shape"@en ;
    rdfs:comment "Validation shape for sentencing guidelines instances."@en ;
    sh:property [
        sh:path icac-sentencing:guidelineSystem ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "federal_guidelines" "state_guidelines" "advisory_guidelines" "mandatory_minimums" "judicial_discretion" ) ;
        sh:message "Sentencing guidelines must specify guideline system from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:baseOffenseLevel ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1 ;
        sh:maxInclusive 43 ;
        sh:message "Base offense level must be between 1 and 43."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:criminalHistoryCategory ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "I" "II" "III" "IV" "V" "VI" ) ;
        sh:message "Criminal history category must be from I to VI."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:adjustmentPoints ;
        sh:datatype xsd:integer ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minInclusive -10 ;
        sh:maxInclusive 20 ;
        sh:message "Adjustment points must be between -10 and 20."@en
    ] .

icac-sentencing:EnhancementFactorShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:EnhancementFactor ;
    rdfs:label "Enhancement Factor Shape"@en ;
    rdfs:comment "Validation shape for enhancement factor instances."@en ;
    sh:property [
        sh:path icac-sentencing:enhancementType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "victim_vulnerability" "leadership_role" "use_of_technology" "commercial_purpose" "distribution_scale" "repeat_offender" "violence_threat" ) ;
        sh:message "Enhancement factor must specify enhancement type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:enhancementValue ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1 ;
        sh:maxInclusive 10 ;
        sh:message "Enhancement factor must have enhancement value between 1 and 10."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:enhancementJustification ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minLength 10 ;
        sh:maxLength 500 ;
        sh:message "Enhancement justification must be between 10 and 500 characters."@en
    ] .

# =============================================================================
# RESTITUTION AND FINES SHAPES
# =============================================================================

icac-sentencing:RestitutionOrderShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:RestitutionOrder ;
    rdfs:label "Restitution Order Shape"@en ;
    rdfs:comment "Validation shape for restitution order instances."@en ;
    sh:property [
        sh:path icac-sentencing:restitutionAmount ;
        sh:datatype xsd:decimal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1.0 ;
        sh:maxInclusive 10000000.0 ;
        sh:message "Restitution amount must be between $1 and $10,000,000."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:paymentSchedule ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "lump_sum" "monthly_payments" "quarterly_payments" "annual_payments" "income_based" "deferred" ) ;
        sh:message "Restitution order must specify payment schedule from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:victimCount ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1 ;
        sh:maxInclusive 1000 ;
        sh:message "Restitution order must specify victim count between 1 and 1000."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:paymentStatus ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:in ( "pending" "current" "delinquent" "completed" "defaulted" "modified" ) ;
        sh:message "Payment status must be from the allowed list."@en
    ] .

icac-sentencing:CriminalFineShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:CriminalFine ;
    rdfs:label "Criminal Fine Shape"@en ;
    rdfs:comment "Validation shape for criminal fine instances."@en ;
    sh:property [
        sh:path icac-sentencing:fineAmount ;
        sh:datatype xsd:decimal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1.0 ;
        sh:maxInclusive 1000000.0 ;
        sh:message "Fine amount must be between $1 and $1,000,000."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:fineType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "statutory_fine" "discretionary_fine" "alternative_fine" "cost_of_prosecution" "forfeiture" ) ;
        sh:message "Criminal fine must specify fine type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:paymentDeadline ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Criminal fine may specify payment deadline."@en
    ] .

# =============================================================================
# TREATMENT ORDER SHAPES
# =============================================================================

icac-sentencing:TreatmentOrderShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:TreatmentOrder ;
    rdfs:label "Treatment Order Shape"@en ;
    rdfs:comment "Validation shape for treatment order instances."@en ;
    sh:property [
        sh:path icac-sentencing:treatmentType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "psychological_counseling" "sex_offender_treatment" "substance_abuse_treatment" "anger_management" "mental_health_treatment" "cognitive_behavioral_therapy" ) ;
        sh:message "Treatment order must specify treatment type from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:treatmentDuration ;
        sh:datatype xsd:decimal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:minInclusive 1.0 ;
        sh:maxInclusive 260.0 ;
        sh:message "Treatment duration must be between 1 and 260 weeks (5 years)."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:treatmentProvider ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "court_approved" "state_certified" "private_practice" "institutional" "community_based" ) ;
        sh:message "Treatment order must specify treatment provider from the allowed list."@en
    ] ;
    sh:property [
        sh:path icac-sentencing:complianceRequired ;
        sh:datatype xsd:boolean ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Treatment order must specify if compliance is required."@en
    ] .

# =============================================================================
# OBJECT PROPERTY SHAPES
# =============================================================================

icac-sentencing:ResultsFromChargeShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:resultsFromCharge ;
    sh:name "results from charge" ;
    sh:description "Links sentencing outcome to legal charge" ;
    sh:class icac-sentencing:LegalCharge ;
    sh:minCount 1 .

icac-sentencing:FollowsGuidelinesShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:followsGuidelines ;
    sh:name "follows guidelines" ;
    sh:description "Links sentencing to guidelines used" ;
    sh:class icac-sentencing:SentencingGuidelines ;
    sh:minCount 0 .

icac-sentencing:IncludesRestitutionShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:includesRestitution ;
    sh:name "includes restitution" ;
    sh:description "Links sentencing to restitution order" ;
    sh:class icac-sentencing:RestitutionOrder ;
    sh:minCount 0 .

icac-sentencing:IncludesFineShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:includesFine ;
    sh:name "includes fine" ;
    sh:description "Links sentencing to criminal fine" ;
    sh:class icac-sentencing:CriminalFine ;
    sh:minCount 0 .

icac-sentencing:RequiresTreatmentShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:requiresTreatment ;
    sh:name "requires treatment" ;
    sh:description "Links sentencing to treatment order" ;
    sh:class icac-sentencing:TreatmentOrder ;
    sh:minCount 0 .

icac-sentencing:AppliesEnhancementShape rdf:type sh:PropertyShape ;
    sh:path icac-sentencing:appliesEnhancement ;
    sh:name "applies enhancement" ;
    sh:description "Links guidelines to enhancement factors" ;
    sh:class icac-sentencing:EnhancementFactor ;
    sh:minCount 0 .

# =============================================================================
# CROSS-REFERENCE VALIDATION SHAPES
# =============================================================================

icac-sentencing:SentencingCrossReferenceShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:SentencingOutcome ;
    rdfs:label "Sentencing Cross Reference Shape"@en ;
    rdfs:comment "Validates cross-references between sentencing and related entities."@en ;
    sh:sparql [
        sh:message "Sentencing outcome must result from at least one legal charge."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this a icac-sentencing:SentencingOutcome .
                FILTER NOT EXISTS {
                    $this icac-sentencing:resultsFromCharge ?charge .
                }
            }
        """
    ] .

icac-sentencing:SentenceDurationValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:SentencingOutcome ;
    rdfs:label "Sentence Duration Validation Shape"@en ;
    rdfs:comment "Validates sentence duration consistency."@en ;
    sh:sparql [
        sh:message "Imprisonment sentences should have duration specified."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this icac-sentencing:sentenceType "imprisonment" .
                FILTER NOT EXISTS {
                    $this icac-sentencing:sentenceDuration ?duration .
                }
            }
        """
    ] .

icac-sentencing:RestitutionValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:RestitutionOrder ;
    rdfs:label "Restitution Validation Shape"@en ;
    rdfs:comment "Validates restitution order consistency."@en ;
    sh:sparql [
        sh:message "Restitution amount should be reasonable for victim count."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this icac-sentencing:restitutionAmount ?amount ;
                      icac-sentencing:victimCount ?victims .
                FILTER (?amount > (?victims * 100000))
            }
        """
    ] .

# =============================================================================
# TEMPORAL VALIDATION SHAPES
# =============================================================================

icac-sentencing:TemporalValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:ConvictionRecord ;
    rdfs:label "Temporal Validation Shape"@en ;
    rdfs:comment "Validates temporal consistency in conviction records."@en ;
    sh:sparql [
        sh:message "Conviction date must be before or equal to sentence date."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this icac-sentencing:convictionDate ?convictionDate .
                ?sentence icac-sentencing:resultsFromCharge ?charge ;
                         icac-sentencing:sentenceDate ?sentenceDate .
                ?charge icac-sentencing:convictionRecord $this .
                FILTER (?convictionDate > ?sentenceDate)
            }
        """
    ] .

icac-sentencing:PaymentDeadlineValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:CriminalFine ;
    rdfs:label "Payment Deadline Validation Shape"@en ;
    rdfs:comment "Validates payment deadline consistency."@en ;
    sh:sparql [
        sh:message "Payment deadline should be in the future when specified."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this icac-sentencing:paymentDeadline ?deadline .
                FILTER (?deadline <= NOW())
            }
        """
    ] .

# =============================================================================
# DATA QUALITY SHAPES
# =============================================================================

icac-sentencing:DataQualityShape rdf:type sh:NodeShape ;
    sh:targetClass icac-sentencing:SentencingOutcome ;
    rdfs:label "Data Quality Shape"@en ;
    rdfs:comment "Validates data quality for sentencing outcomes."@en ;
    sh:property [
        sh:path rdfs:label ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minLength 5 ;
        sh:maxLength 200 ;
        sh:message "Label should be between 5 and 200 characters when provided."@en
    ] ;
    sh:property [
        sh:path rdfs:comment ;
        sh:datatype xsd:string ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:minLength 10 ;
        sh:maxLength 1000 ;
        sh:message "Comment should be between 10 and 1000 characters when provided."@en
    ] . 