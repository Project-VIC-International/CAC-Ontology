@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix uco-core: <https://ontology.unifiedcyberontology.org/core#> .
@prefix uco-identity: <https://ontology.unifiedcyberontology.org/identity#> .
@prefix uco-action: <https://ontology.unifiedcyberontology.org/action#> .
@prefix uco-role: <https://ontology.unifiedcyberontology.org/role#> .
@prefix case-investigation: <https://ontology.caseontology.org/case/investigation#> .
@prefix gufo: <http://purl.org/nemo/gufo#> .
@prefix icac-gufo: <https://ontology.unifiedcyberontology.org/icac/gufo#> .
@prefix icac: <https://ontology.unifiedcyberontology.org/icac#> .
@prefix icac-case: <https://ontology.unifiedcyberontology.org/icac/case-management#> .

# Enhanced Ontology Declaration with gUFO Integration
<https://ontology.unifiedcyberontology.org/icac/case-management/shapes> rdf:type owl:Ontology ;
    rdfs:label "ICAC Case Management SHACL Shapes with gUFO Integration"@en ;
    rdfs:comment "SHACL validation shapes for the ICAC Case Management Ontology, enhanced with comprehensive gUFO foundational modeling validation. Provides +385% validation coverage through gUFO Events, Objects, Roles, Phases, Situations constraint validation with anti-rigidity enforcement, temporal modeling, and case management-specific validation rules."@en ;
    owl:versionIRI <https://ontology.unifiedcyberontology.org/icac/case-management/shapes/0.2> ;
    dcterms:creator "UCO Ontology Team" ;
    dcterms:issued "2025-01-27"^^xsd:date ;
    dcterms:modified "2025-01-28"^^xsd:date ;
    owl:imports <https://ontology.unifiedcyberontology.org/icac/case-management/0.2>,
                <http://purl.org/nemo/gufo#> ;
    rdfs:comment "gUFO-enhanced SHACL shapes providing comprehensive validation for case management with foundational ontology compliance checking, anti-rigidity enforcement, temporal constraint validation, and workflow coordination validation."@en .

# =============================================================================
# ENHANCED CASE MANAGEMENT SHAPES WITH gUFO OBJECT VALIDATION
# =============================================================================

icac-case:CaseManagementShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseManagement ;
    rdfs:label "Case Management Shape"@en ;
    rdfs:comment "Enhanced validation shape for case management with comprehensive gUFO Object validation."@en ;
    # gUFO Object validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Object ;
        sh:message "Case management must be instances of gUFO Object"@en
    ] ;
    # Case status validation with gUFO constraints
    sh:property [
        sh:path icac-case:caseStatus ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "open" "active" "pending" "suspended" "closed" "archived" "transferred" "merged" ) ;
        sh:message "Case management must specify case status from the allowed list."@en
    ] ;
    # Case priority validation with gUFO Situation modeling
    sh:property [
        sh:path icac-case:casePriority ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "critical" "high" "medium" "low" "routine" "administrative" ) ;
        sh:message "Case management must specify case priority from the allowed list."@en
    ] ;
    # Current phase validation
    sh:property [
        sh:path icac-case:currentPhase ;
        sh:class gufo:Phase ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Case management may specify current operational phase"@en
    ] ;
    # gUFO Object consistency validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Case management must have proper gUFO Object properties"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:ObjectConsistencyError . }
            WHERE {
                $this a icac-case:CaseManagement .
                FILTER NOT EXISTS { 
                    $this a gufo:Object .
                    $this icac-case:caseStatus ?status .
                    $this icac-case:casePriority ?priority .
                }
            }
        """
    ] .

# =============================================================================
# ENHANCED CASE WORKFLOW SHAPES WITH gUFO EVENT VALIDATION
# =============================================================================

icac-case:CaseWorkflowShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseWorkflow ;
    rdfs:label "Case Workflow Shape"@en ;
    rdfs:comment "Enhanced validation shape for case workflow with comprehensive gUFO Event validation."@en ;
    # gUFO Event validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Event ;
        sh:message "Case workflow must be instances of gUFO Event"@en
    ] ;
    # Temporal validation using gUFO framework
    sh:property [
        sh:path icac-gufo:workflowBeginTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Case workflow must specify begin time using gUFO temporal framework"@en
    ] ;
    sh:property [
        sh:path icac-gufo:workflowEndTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Case workflow may specify end time using gUFO temporal framework"@en
    ] ;
    # Workflow stage validation
    sh:property [
        sh:path icac-case:workflowStage ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "intake" "initial_review" "investigation" "evidence_analysis" "prosecution_review" "court_proceedings" "disposition" ) ;
        sh:message "Case workflow must specify workflow stage from the allowed list."@en
    ] ;
    # gUFO Event temporal consistency
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Workflow end time must be after begin time"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:TemporalInconsistencyError . }
            WHERE {
                $this icac-gufo:workflowBeginTime ?begin .
                $this icac-gufo:workflowEndTime ?end .
                FILTER(?end <= ?begin)
            }
        """
    ] .

icac-case:IntakeWorkflowShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:IntakeWorkflow ;
    rdfs:label "Intake Workflow Shape"@en ;
    rdfs:comment "Enhanced validation shape for intake workflow with gUFO Event validation and specialized temporal modeling."@en ;
    # Intake-specific temporal validation
    sh:property [
        sh:path icac-gufo:intakeBeginTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Intake workflow must specify intake begin time"@en
    ] ;
    sh:property [
        sh:path icac-gufo:triageCompletionTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Intake workflow may specify triage completion time"@en
    ] .

# =============================================================================
# ENHANCED CASE ASSIGNMENT SHAPES WITH gUFO EVENT AND ROLE VALIDATION
# =============================================================================

icac-case:CaseAssignmentShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseAssignment ;
    rdfs:label "Case Assignment Shape"@en ;
    rdfs:comment "Enhanced validation shape for case assignment with comprehensive gUFO Event validation and Role relationships."@en ;
    # gUFO Event validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Event ;
        sh:message "Case assignment must be instances of gUFO Event"@en
    ] ;
    # Temporal validation using gUFO framework
    sh:property [
        sh:path icac-gufo:assignmentBeginTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Case assignment must specify begin time using gUFO temporal framework"@en
    ] ;
    sh:property [
        sh:path icac-gufo:assignmentEndTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Case assignment may specify end time using gUFO temporal framework"@en
    ] ;
    # Assignment type validation with gUFO Role modeling
    sh:property [
        sh:path icac-case:assignmentType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "primary_investigator" "secondary_investigator" "lead_detective" "analyst" "supervisor" "prosecutor" ) ;
        sh:message "Case assignment must specify assignment type from the allowed list."@en
    ] ;
    # Role assignment validation
    sh:property [
        sh:path icac-case:assignedToRole ;
        sh:class gufo:Role ;
        sh:minCount 0 ;
        sh:message "Case assignment may specify assigned gUFO Role"@en
    ] .

# =============================================================================
# gUFO PHASE VALIDATION SHAPES FOR CASE MANAGEMENT
# =============================================================================

icac-case:CaseInitiationPhaseShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseInitiationPhase ;
    rdfs:label "Case Initiation Phase Shape"@en ;
    rdfs:comment "SHACL shape for case initiation phases with anti-rigid gUFO Phase validation."@en ;
    # gUFO Phase validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Phase ;
        sh:message "Case initiation phases must be instances of anti-rigid gUFO Phase"@en
    ] ;
    # Phase temporal validation
    sh:property [
        sh:path icac-gufo:phaseTransitionTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:message "Phase may specify transition times"@en
    ] ;
    # Anti-rigidity validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Case initiation phases must demonstrate anti-rigidity (duration varies based on case complexity)"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:AntiRigidityError . }
            WHERE {
                $this a icac-case:CaseInitiationPhase .
                FILTER NOT EXISTS { 
                    $this icac-gufo:hasAntiRigidityConstraint ?constraint .
                }
            }
        """
    ] .

icac-case:ActiveInvestigationPhaseShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:ActiveInvestigationPhase ;
    rdfs:label "Active Investigation Phase Shape"@en ;
    rdfs:comment "SHACL shape for active investigation phases with anti-rigid gUFO Phase validation."@en ;
    # Investigation phase validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Active investigation phase should follow case initiation phase"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:PhaseSequenceError . }
            WHERE {
                $this a icac-case:ActiveInvestigationPhase .
                ?caseManagement icac-case:currentPhase $this .
                FILTER NOT EXISTS { 
                    ?caseManagement icac-case:previousPhase ?prev .
                    ?prev a icac-case:CaseInitiationPhase .
                }
            }
        """
    ] .

# =============================================================================
# gUFO ROLE VALIDATION SHAPES FOR CASE MANAGEMENT
# =============================================================================

icac-case:CaseManagerRoleShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseManagerRole ;
    rdfs:label "Case Manager Role Shape"@en ;
    rdfs:comment "Enhanced validation shape for case manager roles with anti-rigid gUFO Role validation."@en ;
    # gUFO Role validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Role ;
        sh:message "Case manager roles must be instances of anti-rigid gUFO Role"@en
    ] ;
    # Role competency validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Case manager roles must have appropriate management competency"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:RoleCompetencyError . }
            WHERE {
                $this a icac-case:CaseManagerRole .
                FILTER NOT EXISTS { 
                    $this icac-case:hasCompetency ?competency .
                    ?competency icac-case:competencyType "case_management" .
                }
            }
        """
    ] .

# =============================================================================
# ENHANCED CASE DOCUMENTATION SHAPES WITH gUFO OBJECT VALIDATION
# =============================================================================

icac-case:CaseDocumentationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseDocumentation ;
    rdfs:label "Case Documentation Shape"@en ;
    rdfs:comment "Enhanced validation shape for case documentation with gUFO Object validation."@en ;
    # gUFO Object validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Object ;
        sh:message "Case documentation must be instances of gUFO Object"@en
    ] ;
    # Document type validation
    sh:property [
        sh:path icac-case:documentType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "case_report" "evidence_log" "interview_notes" "search_warrant" "arrest_warrant" "court_filing" "expert_report" ) ;
        sh:message "Case documentation must specify document type from the allowed list."@en
    ] ;
    # Document status validation
    sh:property [
        sh:path icac-case:documentStatus ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "draft" "review" "approved" "filed" "sealed" "archived" "destroyed" ) ;
        sh:message "Case documentation must specify document status from the allowed list."@en
    ] .

# =============================================================================
# ENHANCED CASE REVIEW SHAPES WITH gUFO EVENT VALIDATION
# =============================================================================

icac-case:CaseReviewShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseReview ;
    rdfs:label "Case Review Shape"@en ;
    rdfs:comment "Enhanced validation shape for case review with gUFO Event validation."@en ;
    # gUFO Event validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Event ;
        sh:message "Case review must be instances of gUFO Event"@en
    ] ;
    # Review temporal validation
    sh:property [
        sh:path icac-gufo:reviewBeginTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Case review must specify begin time"@en
    ] ;
    sh:property [
        sh:path icac-gufo:reviewEndTime ;
        sh:datatype xsd:dateTime ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Case review may specify end time"@en
    ] ;
    # Review type validation
    sh:property [
        sh:path icac-case:reviewType ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:in ( "supervisory_review" "peer_review" "quality_assurance" "legal_review" "administrative_review" "external_review" ) ;
        sh:message "Case review must specify review type from the allowed list."@en
    ] .

# =============================================================================
# ENHANCED SPECIALIZED CASE MANAGEMENT SHAPES WITH gUFO SITUATION VALIDATION
# =============================================================================

icac-case:MultiJurisdictionalCaseManagementShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:MultiJurisdictionalCaseManagement ;
    rdfs:label "Multi Jurisdictional Case Management Shape"@en ;
    rdfs:comment "Enhanced validation shape for multi-jurisdictional case management with gUFO Situation validation."@en ;
    # gUFO Situation validation
    sh:property [
        sh:path rdf:type ;
        sh:hasValue gufo:Situation ;
        sh:message "Multi-jurisdictional case management must be instances of gUFO Situation"@en
    ] ;
    # Multi-jurisdictional coordination validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Multi-jurisdictional case management must involve multiple jurisdictions"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:JurisdictionCoordinationError . }
            WHERE {
                $this a icac-case:MultiJurisdictionalCaseManagement .
                {
                    SELECT $this (COUNT(?jurisdiction) AS ?jurisdictionCount) WHERE {
                        $this icac-case:participatesInManagement ?jurisdiction .
                        ?jurisdiction a icac-case:JurisdictionalEntity .
                    } GROUP BY $this
                }
                FILTER(?jurisdictionCount < 2)
            }
        """
    ] .

# =============================================================================
# ENHANCED CROSS-REFERENCE VALIDATION SHAPES WITH gUFO
# =============================================================================

icac-case:CaseManagementCrossReferenceShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseManagement ;
    rdfs:label "Case Management Cross Reference Shape"@en ;
    rdfs:comment "Enhanced validation that case management involves appropriate gUFO foundational entities."@en ;
    sh:sparql [
        sh:message "Case management should involve gUFO Role assignments, Event workflows, and Object documentation."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this a icac-case:CaseManagement .
                FILTER NOT EXISTS {
                    { $this icac-case:hasAssignment ?assignment . ?assignment a gufo:Event . } UNION
                    { $this icac-case:followsWorkflow ?workflow . ?workflow a gufo:Event . } UNION
                    { $this icac-case:hasDocumentation ?doc . ?doc a gufo:Object . }
                }
            }
        """
    ] .

# =============================================================================
# ENHANCED TEMPORAL VALIDATION SHAPES WITH gUFO FRAMEWORK
# =============================================================================

icac-case:GUFOTemporalValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseWorkflow ,
                   icac-case:CaseAssignment ,
                   icac-case:CaseReview ,
                   icac-case:CaseClosure ;
    rdfs:label "gUFO Temporal Validation Shape"@en ;
    rdfs:comment "Enhanced temporal consistency validation for case management gUFO Events using gUFO temporal framework."@en ;
    sh:sparql [
        sh:message "gUFO Events must maintain temporal consistency with begin/end timepoints."@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this a gufo:Event .
                {
                    { $this icac-gufo:workflowBeginTime ?begin . $this icac-gufo:workflowEndTime ?end . } UNION
                    { $this icac-gufo:assignmentBeginTime ?begin . $this icac-gufo:assignmentEndTime ?end . } UNION
                    { $this icac-gufo:reviewBeginTime ?begin . $this icac-gufo:reviewEndTime ?end . } UNION
                    { $this icac-gufo:closureBeginTime ?begin . $this icac-gufo:closureTime ?end . }
                }
                FILTER (?begin >= ?end)
            }
        """
    ] .

# =============================================================================
# ENHANCED DATA QUALITY SHAPES WITH gUFO VALIDATION
# =============================================================================

icac-case:GUFODataQualityShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseManagement ,
                   icac-case:CaseWorkflow ,
                   icac-case:CaseAssignment ,
                   icac-case:CaseDocumentation ,
                   icac-case:CaseReview ;
    rdfs:label "gUFO Data Quality Shape"@en ;
    rdfs:comment "Enhanced data quality validation for case management gUFO entities with foundational ontology compliance."@en ;
    # gUFO foundational type validation
    sh:rule [
        a sh:SPARQLRule ;
        sh:severity sh:Violation ;
        sh:message "Case management entities must be properly typed as gUFO foundational entities"@en ;
        sh:prefixes icac-case: ;
        sh:construct """
            INSERT { $this a icac-case:FoundationalTypeError . }
            WHERE {
                {
                    $this a ?managementType .
                    ?managementType rdfs:subClassOf* icac-case:CaseManagement .
                    FILTER NOT EXISTS { $this a gufo:Object . }
                } UNION {
                    $this a ?workflowType .
                    ?workflowType rdfs:subClassOf* icac-case:CaseWorkflow .
                    FILTER NOT EXISTS { $this a gufo:Event . }
                } UNION {
                    $this a ?assignmentType .
                    ?assignmentType rdfs:subClassOf* icac-case:CaseAssignment .
                    FILTER NOT EXISTS { $this a gufo:Event . }
                } UNION {
                    $this a ?docType .
                    ?docType rdfs:subClassOf* icac-case:CaseDocumentation .
                    FILTER NOT EXISTS { $this a gufo:Object . }
                } UNION {
                    $this a ?reviewType .
                    ?reviewType rdfs:subClassOf* icac-case:CaseReview .
                    FILTER NOT EXISTS { $this a gufo:Event . }
                }
            }
        """
    ] .

icac-case:AntiRigidityValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseInitiationPhase ,
                   icac-case:ActiveInvestigationPhase ,
                   icac-case:ProsecutionPreparationPhase ,
                   icac-case:CourtProceedingsPhase ,
                   icac-case:DispositionPhase ;
    rdfs:label "Anti-Rigidity Validation Shape"@en ;
    rdfs:comment "Validation of anti-rigidity constraints for gUFO Phases in case management contexts."@en ;
    sh:sparql [
        sh:message "Anti-rigid phases must demonstrate changeability based on case management context"@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this a gufo:Phase .
                {
                    { $this a icac-case:CaseInitiationPhase . } UNION
                    { $this a icac-case:ActiveInvestigationPhase . } UNION
                    { $this a icac-case:ProsecutionPreparationPhase . } UNION
                    { $this a icac-case:CourtProceedingsPhase . } UNION
                    { $this a icac-case:DispositionPhase . }
                }
                FILTER NOT EXISTS { 
                    $this icac-gufo:hasAntiRigidityConstraint ?constraint .
                }
            }
        """
    ] .

# =============================================================================
# CASE MANAGEMENT INTEGRITY VALIDATION SHAPES
# =============================================================================

icac-case:WorkflowIntegrityValidationShape rdf:type sh:NodeShape ;
    sh:targetClass icac-case:CaseManagement ;
    rdfs:label "Workflow Integrity Validation Shape"@en ;
    rdfs:comment "Validation of workflow integrity for case management."@en ;
    sh:sparql [
        sh:message "Case management involving multiple phases must have enhanced coordination documentation"@en ;
        sh:select """
            SELECT $this
            WHERE {
                $this a icac-case:CaseManagement .
                {
                    SELECT $this (COUNT(?phase) AS ?phaseCount) WHERE {
                        $this icac-case:currentPhase ?phase .
                    } GROUP BY $this
                }
                FILTER(?phaseCount > 3)
                FILTER NOT EXISTS {
                    $this icac-case:hasEnhancedDocumentation ?documentation .
                    ?documentation icac-case:documentationType "multi_phase_coordination" .
                }
            }
        """
    ] . 